#include <errno.h>
#include <stdio.h>

#include "cred.h"
#include "kallsyms.h"

prepare_kernel_cred_t prepare_kernel_cred;
commit_creds_t commit_creds;

bool
setup_prepare_kernel_cred_address(void)
{
  if (prepare_kernel_cred) {
    return true;
  }

  prepare_kernel_cred = (prepare_kernel_cred_t)device_get_symbol_address(DEVICE_SYMBOL(prepare_kernel_cred));

  if (!prepare_kernel_cred && kallsyms_exist()) {
    prepare_kernel_cred = kallsyms_get_symbol_address("prepare_kernel_cred");
  }

  return !!prepare_kernel_cred;
}

bool
setup_commit_creds_address(void)
{
  if (commit_creds) {
    return true;
  }

  commit_creds = (commit_creds_t)device_get_symbol_address(DEVICE_SYMBOL(commit_creds));

  if (!commit_creds && kallsyms_exist()) {
    commit_creds = kallsyms_get_symbol_address("commit_creds");
  }

  return !!commit_creds;
}
