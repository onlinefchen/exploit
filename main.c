#include <stdio.h>
#include <stdint.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <errno.h>
#include <sys/types.h>
#include <unistd.h>
#include <sys/stat.h>
#include <fcntl.h>
#include "kallsyms.h"

int run_bash(const char *command)
{
	if(getuid() != 0) {
		printf("failed to obtain root\n");
		return -1;
	}

	if (!command) {
		printf("run root with system/bin/sh");
		system("/system/bin/sh");
	} else {
		printf("run root with system/bin/sh");
		execl("/system/bin/sh", "/system/bin/sh", "-c", command, NULL);
	}
	return 0;
}

int main(void)
{
	void *test;
	printf("hello world!\n");
	if(kallsyms_exist()) {
		printf("kallsyms exist\n");
	}

	test = kallsyms_get_symbol_address("prepare_kernel_cred");
	printf("prepare_kernel_cred %lx\n", test);

	run_bash(NULL);
	printf("\nend of bash\n");
	return 0;
}
